Итак, давайте рассмотрим чуть поближе основные компоненты Kubernetes. 

Начнем с входной точки для кластера, через которую происходит управление кластером и взаимодействие компонентов - **API Server**

Спроксируем **API Server** на локальный порт `8080` с помощью команды`./proxy_api_server_to_localhost_8080.sh &`

**Запускаем команду.**

Теперь обращаясь по локальному порту `8080`, мы можем совершать запросы к **API Server**-у.

API Server позволяет получить данные конфигурации кластера. Например, мы можем получить конфигурацию и состояние кластера, относящуюся к **controlplane** ноде, сделав запрос утилитой curl к API Server-у по урлу /api/v1/nodes/controlplane/. Запрос выдаст довольно большой json с описанием состояния ноды.  Мы его отформатируем с помощью утилиты jq. С этой утилитой мы с вами еще не раз встретимся. Она позволяет форматировать, фильтровать и преобразовывать текстовый вывод в формате json.   

**Запускаем команду.**

В ответе от API Server-а довольно много информации. Начиная от ip адреса ноды, до списка образов контейнеров, которые на ней хранятся. 

Хранилищем для API-Serverа является etcd. Etcd - это децентрализованное и отказоустойчивое key-value хранилище. И информация, которую мы получили в ответе от апи сервера, хранится на самом деле в нем. Правда в своем внутреннем формате. 

Мы с вами можем посмотреть информацию о ноде напрямую в etcd. Для этого воспользуемся утилитой etcdctl. Для подключения к etcd нужны сертификаты и имя ключа, по которому нужная нам информация хранится. Информация о ноде хранится в ключе /registry/minions/controlplane. Для того, чтобы проще было передать сертификаты, запустим утилиту etcdctl из контейнера самого etcd. 

Для этого сохраним id контейнера,  в котором запущен **etcd**, в переменную окружения `ETCD_DOCKER_ID` . **Запускаем команду** 

И теперь запускаем etcdctl из контейнера etcd, передав в параметрах сертификаты для аутентификации и имя ключа:

**Запускаем команду.**

Собственно в ответе видим ту же самую информацию, что и в json-е выше, только в своем внутреннем формате.

Также можем посмотреть, какие еще есть ключи. Передаем утилите etcdctl соответствующие параметры и **запускаем команду**.

Видим с вами довольно много ключей, в каждом из которых хранится какой кусочек конфигурации и статуса кластера.  

Через **API Server** пользователи и внутренние компоненты кластера получают и обновляют конфигурацию кластера, которая хранится в **etcd**. 

В следующей демонстрации давайте с вами через API Server попробуем запустить контейнер с приложением, т.е. запустить полезную рабочую нагрузку.

Очистим терминалы.

`clear`{{execute T1}} `clear`{{execute T2}}